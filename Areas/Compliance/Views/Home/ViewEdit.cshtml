@{
    ViewBag.Title = "ViewEdit";
    Layout = "~/Views/Shared/_Layout.cshtml";}
<h2>
    ViewEdit</h2>
@Html.Hidden("hdnUserId", (string)(@ViewBag.UserID)) @Html.Hidden("hdnAgencyId", (string)(@ViewBag.AgencyID))
@Html.Hidden("hdnAccountNumber", (string)(@ViewBag.Account)) @Html.Hidden("hdnUserRole", (string)(@ViewBag.UserRole))
<style>
    
</style>
<div id="fileUploadContainer" style="display:none" data-bind="with:complianceModel">
    @using (Html.BeginForm("UploadDocument", "Home", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
    

        <div data-bind="visible:complaintinfoDocumentChecked">
            Select document for complaint information:<input name="complaintDocument" type="file" />
        </div>

        <div data-bind="visible:debtOwnerProcessDocumentChecked">
            Select document for debt owner process:<input name="debtOwnerProcessDocument" type="file" />
        </div>

        <input type="hidden" name="hdnAccount" data-bind="value:account" />

        <input type="hidden" name="hdnAgency" data-bind="value:agency" />

        <input type="submit" value="Submit" />
    
    }
</div>
<div id="newComplaintContainer">
    <table class="tblCommon" style="width: 100%">
        <tr>
            <td>
                <div id="messageSummary" style="font-size: small">
                    <ul>
                    </ul>
                </div>
            </td>
        </tr>
        <tr>
            <td style="text-align: center">
                <div data-bind="fadeVisible:showMessage" style="background-color: #1f497d; color: #fff">
                    <span data-bind="text:message"></span>
                </div>
            </td>
        </tr>
        <tr>
            <td style="text-align: right">
                <img src="~/Content/images/savebutton.png" data-bind="click:saveComplaint,visible:saveVisible" />
            </td>
        </tr>
        <tr>
            <td>
                <table class="PIMSDatatable" style="width: 100%;">
                    <tr>
                        <td style="width: 100%; background-color: #1f497d">
                            <a href="#" style="text-decoration: none; font-weight: bold; color: white" data-bind="click:showHideDebtInformation">
                                Debtor & Debt Information</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="debtInformation" data-bind="with:complianceModel,visible:showDebtInformation">
                                <table class="debtorInfo">
                                    <tr>
                                        <td colspan="6" style="text-align: right">
                                            * = Required fields
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Agency Name
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left;" colspan="4">
                                            <select data-bind="options:$parent.agencies,optionsValue:'Value', optionsCaption:' ',optionsText: 'Text', value: agency,disable:$parent.agenciesDisable">
                                            </select>*
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Consumer Account #
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:account" />*
                                        </td>
                                        <td style="text-align: right; width: 20%">
                                            Last 4 of SSN
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:lastFourSSN" />*
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Last Name
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:lastName" />*
                                        </td>
                                        <td style="text-align: right; width: 20%">
                                            Verified Debtor Identity?
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.debtorIdentities,optionsValue:'Value', optionsText: 'Text', value: debtorIdentityVerified_YesNo">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            First Name
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:firstName" />
                                            *
                                            <td style="text-align: right; width: 20%">
                                                Best Contact Method
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.contactMethods,optionsValue:'Value', optionsText: 'Text', optionsCaption: ' ', value: contactMethodId">
                                                </select>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Address
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:address" />
                                            <td style="text-align: right; width: 20%">
                                                Best Contact Time
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.contactTimeOptions,optionsValue:'Value', optionsText: 'Text', optionsCaption: ' ', value: contactTimeId">
                                                </select>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            City
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:city" />
                                            <td style="text-align: right; width: 20%">
                                                Creditor Name
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" data-bind="value:creditorName" />
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            State
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.stateOptions,optionsValue:'Value', optionsText: 'Text', optionsCaption: ' ', value: state">
                                            </select>
                                            <td style="text-align: right; width: 20%">
                                                Debt Product
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.debtProductOptions,optionsValue:'Value', optionsText: 'Text', optionsCaption: ' ', value: debtProductId">
                                                </select>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Zip
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:zip" />
                                            <td style="text-align: right; width: 20%">
                                                Debt Balance at Purchase
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" data-bind="value:debtPurchaseBalance" />
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Home Phone
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:homePhone" />
                                            <td style="text-align: right; width: 20%">
                                                Debt Balance (Current)
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" data-bind="value:debtCurrentBalance" />
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Work Phone
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:workPhone" />
                                            <td style="text-align: right; width: 20%">
                                                Dispute Debt?
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.disputeDebtOptions,optionsValue:'Value', optionsText: 'Text', value: disputeDebt_YesNo">
                                                </select>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Mobile Phone
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:mobilePhone" />
                                            <td style="text-align: right; width: 20%">
                                                Dispute Debt Amount?
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.disputeDebtAmtOptions,optionsValue:'Value', optionsText: 'Text', value: disputeDebtAmount_YesNo">
                                                </select>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            &nbsp;
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            &nbsp;
                                            <td style="text-align: right; width: 20%">
                                                Dispute Debt Due Date?
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.disputeDebtDueDateOptions,optionsValue:'Value', optionsText: 'Text', value: disputeDebtDueDate_YesNo">
                                                </select>
                                            </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 100%; background-color: #1f497d">
                            <a href="#" style="text-decoration: none; font-weight: bold; color: white" data-bind="click:showHideComplaintInformation">
                                Complaint Information</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="complaintInformation" data-bind="with:complianceModel,visible:showComplaintInformation">
                                <table class="complaintInfo">
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Complaint ID #
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value:complaintID,enable:false" />
                                            *
                                            <td style="text-align: right; width: 20%">
                                                Complaint Date
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" id="complaiintDate" data-bind="value:complaintDate" />
                                        *
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Complaint Received By
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.complaintRecvdByOptions,optionsValue:'Value', optionsText: 'Text', optionsCaption: ' ', value: complaintReceivedByMethodId">
                                            </select>
                                            <td style="text-align: right; width: 20%">
                                                Complaint Issue
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.complaintIssueOptions,optionsValue:'Value', optionsText: 'Text', optionsCaption: ' ', value: complaintIssueId">
                                                </select>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Complaint Notes
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <textarea rows="4" cols="25" data-bind="value:complaintNotes"></textarea>
                                            <td style="text-align: right; width: 20%">
                                                Upload Document
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="checkbox" data-bind="checked: complaintinfoDocumentChecked" />&nbsp;<a
                                                    data-bind="attr: { href: complaintDocUrl }"><span data-bind="text:complaintDocument"></span></a>
                                            </td>
                                    </tr>
                                    <tr data-bind="visible:$parent.showComplaintSumittedToAgencyInfo">
                                        <td style="text-align: right; width: 20%">
                                            Submitted Complaint to Agency?
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.yesNoOptions,optionsValue:'Value', optionsText: 'Text', value:complaintSubmitedToAgency_YesNo">
                                            </select>
                                            <td style="text-align: right; width: 20%">
                                                Date Submitted
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" id="dateSubmittedToAgency" data-bind="value:complaintSubmitedToAgencyDate" />
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Need More Info from Debtor?
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.needMoreInfoDebtorOptions,optionsValue:'Value', optionsText: 'Text', value:moreInfoReqdFromDebtor_YesNo">
                                            </select>
                                            <td style="text-align: right; width: 20%">
                                                Date Requested
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" id="moreInfoRequestedDate" data-bind="value:moreInfoRequestedDate" />
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            More Info Requested
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <textarea rows="4" cols="25" data-bind="value:moreInfoRequested"></textarea>
                                            <td style="text-align: right; width: 20%">
                                                More Debtor Info Received?
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.moreInfoRecvdDebtorOptions,optionsValue:'Value', optionsText: 'Text', value:moreInfoReceivedFromDebtor_YesNo">
                                                </select>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Date Received
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="moreInfoReceivedDate" data-bind="value:moreInfoReceivedDate" />
                                            <td style="text-align: right; width: 20%">
                                                More Info Received
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <textarea rows="4" cols="25" data-bind="value:moreInfoReceived"></textarea>
                                            </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 100%; background-color: #1f497d">
                            <a href="#" style="text-decoration: none; font-weight: bold; color: white" data-bind="click:showHideDebtOwnerProcess">
                                Debt Owner Process</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="debtOwnerProcess" data-bind="with:complianceModel,visible:showDebtOwnerProcess">
                                <table class="debtOwnerInfo">
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Submitted Complaint to Owner?
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.complaintSubmittedToOwnerOptions,optionsValue:'Value', optionsText: 'Text', value:complaintSubmittedToOwner_YesNo">
                                            </select>
                                            <td style="text-align: right; width: 20%">
                                                Date Submitted
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" id="complaintSubmittedDate" data-bind="value:complaintSubmittedDate" />
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Time to Submit (Days)
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" disabled="disabled" data-bind="value:timeToSubmitDays" />
                                            <td style="text-align: right; width: 20%">
                                                Upload Document
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="checkbox" data-bind="checked: debtOwnerProcessDocumentChecked" />&nbsp;<a
                                                    data-bind="attr: { href: debtOwnerProcessDocUrl }"><span data-bind="text:debtOwnerProcessDocument"></span></a>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Need More Info from Agency?
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.moreInfoFromAgencyOptions,optionsValue:'Value', optionsText: 'Text', value:moreInfoFromAgency_YesNo">
                                            </select>
                                            <td style="text-align: right; width: 20%">
                                                Date Requested
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" id="moreInfoFromAgencyRequestedDate" data-bind="value:moreInfoFromAgencyRequestedDate" />
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            More Info Requested
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <textarea rows="4" cols="25" data-bind="value:moreInfoFromAgencyRequested"></textarea>
                                            <td style="text-align: right; width: 20%">
                                                More Agency Info Received?
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.moreInfoFromAgencyReceivedOptions,optionsValue:'Value', optionsText: 'Text', value:moreInfoFromAgencyReceived_YesNo">
                                                </select>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Date Received
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="moreInfoFromAgencyReceivedDate" data-bind="value:moreInfoFromAgencyReceivedDate" />
                                            <td style="text-align: right; width: 20%">
                                                More Info Received
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <textarea rows="4" cols="25" data-bind="value:moreInfoFromAgencyReceived"></textarea>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Owner Response
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.ownerResponseOptions,optionsValue:'Value', optionsText: 'Text', optionsCaption:' ',value:ownerResponseId">
                                            </select>
                                            <td style="text-align: right; width: 20%">
                                                &nbsp;
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                &nbsp;
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Owner Response to Agency Date
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="ownerResponseDate" data-bind="value:ownerResponseDate" />
                                            <td style="text-align: right; width: 20%">
                                                Owner Response (Days)
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" disabled="disabled" data-bind="value:ownerResponseDays" />
                                            </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 100%; background-color: #1f497d">
                            <a href="#" style="text-decoration: none; font-weight: bold; color: white" data-bind="click:showHideComplaintClosure">
                                Complaint Closure</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="complaintClosure" data-bind="with:complianceModel,visible:showComplaintClosure">
                                <table class="complaintClosureInfo">
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Agency Response to Debtor Date
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="agencyResponseToDebtorDate" data-bind="value:agencyResponseToDebtorDate" />
                                            <td style="text-align: right; width: 20%">
                                                Total Response Time (Days)
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <input type="text" disabled="disabled" data-bind="value:totalResponseTimeDays" />
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Debtor Agree?
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.debtorAgreeOptions,optionsValue:'Value', optionsText: 'Text', value:debtorAgree_YesNo">
                                            </select>
                                            <td style="text-align: right; width: 20%">
                                                Need further Action?
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                                :
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                <select data-bind="options:$parent.needFurtherActionOptions,optionsValue:'Value', optionsText: 'Text', value:needFurtherAction_YesNo">
                                                </select>
                                            </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">
                                            Final Action Steps
                                        </td>
                                        <td style="text-align: center; width: 1%">
                                            :
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options:$parent.finalActionStepOptions,optionsValue:'Value',optionsCaption: ' ', optionsText: 'Text', value:finalActionStepId">
                                            </select>
                                            <td style="text-align: right; width: 20%">
                                                &nbsp;
                                            </td>
                                            <td style="text-align: center; width: 1%">
                                            </td>
                                            <td style="text-align: left; width: 20%">
                                                &nbsp;
                                            </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>
@Scripts.Render("~/bundles/knockout")
@section scripts{
    <script src="~/Scripts/jquery-ui-1.8.11.js" type="text/javascript"></script>
    <script src="~/Scripts/compliance.js" type="text/javascript"></script>
    <script src="~/Scripts/jquery.formatCurrency-1.4.0.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        var yesNoOptions = [{ Text: 'No', Value: 'false' }, { Text: 'Yes', Value: 'true'}];
        function pageViewModel(userId, userAgency, accountNumber, userRole) {
            var self = this;

            self.complianceModel = new complianceVM(userId, userAgency);            
            self.pimsAccountNumber = ko.observable(accountNumber);
            self.debtors = ko.observableArray([]);
            self.userRole = ko.observable(userRole);
            self.getComplaint = function (account) {
                //log(debtor.account());
                function setComplaint(data) {
                    self.complianceModel.populateCompliance(data.Account, data.FirstName, data.LastName, data.DOB, data.Address, data.City, data.State, data.Zip, data.LastFourSSN, data.MobilePhone, data.HomePhone, data.WorkPhone, data.DebtorIdentityVerifiedYN, ((data.DebtCurrentBalance == undefined) ? '' : formatCurrency(data.DebtCurrentBalance)), ((data.DebtPurchaseBalance == undefined) ? '' : formatCurrency(data.DebtPurchaseBalance)), data.CreditorName, data.DebtProductId, data.DebtPurchaseBalance, data.DebtCurrentBalance, data.DisputeDebtYN, data.DisputeDebtAmountYN, data.DisputeDebtDueDateYN, data.ComplaintID, data.ComplaintDate, data.ComplaintReceivedByMethodId, data.ComplaintIssueId, data.ComplaintNotes, data.ComplaintSubmitedToAgencyYN, data.ComplaintSubmitedToAgencyDate, data.MoreInfoReqdFromDebtorYN, data.MoreInfoRequestedDate, data.MoreInfoRequested, data.MoreInfoReceivedFromDebtorYN, data.MoreInfoReceivedDate, data.MoreInfoReceived, data.ComplaintSubmittedToOwnerYN, data.ComplaintSubmittedDate, data.TimeToSubmitDays, data.MoreInfoFromAgencyYN, data.MoreInfoFromAgencyRequestedDate, data.MoreInfoFromAgencyRequested, data.MoreInfoFromAgencyReceived, data.MoreInfoFromAgencyReceivedYN, data.MoreInfoFromAgencyReceivedDate, data.OwnerResponseId, data.OwnerResponseDate, data.OwnerResponseDays, data.AgencyResponseToDebtorDate, data.TotalResponseTimeDays, data.DebtorAgreeYN, data.NeedFurtherActionYN, data.FinalActionStepId, data.CreatedBy, data.ComplaintDocument, data.DebtOwnerProcessDocument);
                };
                self.pimsAccountNumber(account);
                $.ajax({
                    url: baseUrl + '/api/Compliance/',
                    type: "GET",
                    data: { accountNumber: self.pimsAccountNumber(), agencyId: self.complianceModel.agency(), userRole: self.userRole },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    async: false,
                    success: function (data) {
                        setComplaint(data);
                    },
                    error: function (response, errorText) {
                        log(errorText);
                        return false;
                    }
                });
                //self.saveVisible(true);
            }
            self.agenciesDisable = ko.computed(function () { return (self.userRole() == 'agency' || self.pimsAccountNumber() == '' || self.pimsAccountNumber() == undefined) ? true : false }, self);
            self.agencies = ko.computed(function () {
                var localAgencies = [];
                $.ajax({
                    url: baseUrl + '/api/Lookup/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { id: 'Agencies' },
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        //log(data.length);
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                //log(item.Text);
                                localAgencies.push(item);
                            });
                        }
                    },
                    error: function (xhr, status, somthing) {
                        log(status);
                    }
                });
                return localAgencies;
            }, self);
            //For Div debtInformation
            self.debtorIdentities = ko.observableArray(yesNoOptions);
            self.debtorIdentities = ko.observableArray(yesNoOptions);
            self.contactMethods = ko.computed(function () {
                var localContactMethods = [];
                $.ajax({
                    url: baseUrl + '/api/Lookup/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { id: 'DebtorContactMethods' },
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        //log(data.length);
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                //log(item.Text);
                                localContactMethods.push(item);
                            });
                        }
                    },
                    error: function (xhr, status, somthing) {
                        log(status);
                    }
                });
                return localContactMethods;
            }, self);
            self.contactTimeOptions = ko.computed(function () {
                var localTimeOptions = [];
                $.ajax({
                    url: baseUrl + '/api/Lookup/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { id: 'DebtorContactTime' },
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        //log(data.length);
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                //log(item.Text);
                                localTimeOptions.push(item);
                            });
                        }
                    },
                    error: function (xhr, status, somthing) {
                        log(status);
                    }
                });
                return localTimeOptions;
            }, self);
            self.stateOptions = ko.computed(function () {
                var localStates = [];
                $.ajax({
                    url: baseUrl + '/api/Lookup/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { id: 'USStates' },
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        //log(data.length);
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                //log(item.Text);
                                localStates.push(item);
                            });
                        }
                    },
                    error: function (xhr, status, somthing) {
                        log(status);
                    }
                });
                return localStates;
            }, self);
            self.debtProductOptions = ko.computed(function () {
                var localProducts = [];
                $.ajax({
                    url: baseUrl + '/api/Lookup/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { id: 'DetorProducts' },
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        //log(data.length);
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                //log(item.Text);
                                localProducts.push(item);
                            });
                        }
                    },
                    error: function (xhr, status, somthing) {
                        log(status);
                    }
                });
                return localProducts;
            }, self);
            self.disputeDebtOptions = ko.observableArray(yesNoOptions);
            self.disputeDebtAmtOptions = ko.observableArray(yesNoOptions);
            self.disputeDebtDueDateOptions = ko.observableArray(yesNoOptions);

            //For complaintInformation
            self.complaintRecvdByOptions = ko.computed(function () {
                var localComplaintReceivedBy = [];
                $.ajax({
                    url: baseUrl + '/api/Lookup/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { id: 'ComplaintReceivedBy' },
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        //log(data.length);
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                //log(item.Text);
                                localComplaintReceivedBy.push(item);
                            });
                        }
                    },
                    error: function (xhr, status, somthing) {
                        log(status);
                    }
                });
                return localComplaintReceivedBy;
            }, self);
            self.complaintIssueOptions = ko.computed(function () {
                var localComplaintIssues = [];
                $.ajax({
                    url: baseUrl + '/api/Lookup/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { id: 'ComplaintIssues' },
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        //log(data.length);
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                //log(item.Text);
                                localComplaintIssues.push(item);
                            });
                        }
                    },
                    error: function (xhr, status, somthing) {
                        log(status);
                    }
                });
                return localComplaintIssues;
            }, self);
            self.needMoreInfoDebtorOptions = ko.observableArray(yesNoOptions);
            self.moreInfoRecvdDebtorOptions = ko.observableArray(yesNoOptions);
            self.yesNoOptions = ko.observableArray(yesNoOptions);

            //Debt Owner
            self.complaintSubmittedToOwnerOptions = ko.observableArray(yesNoOptions);
            self.moreInfoFromAgencyOptions = ko.observableArray(yesNoOptions);
            self.moreInfoFromAgencyReceivedOptions = ko.observableArray(yesNoOptions);
            self.ownerResponseOptions = ko.computed(function () {
                var localOwnerResponse = [];
                $.ajax({
                    url: baseUrl + '/api/Lookup/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { id: 'OwnerResponse' },
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        //log(data.length);
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                //log(item.Text);
                                localOwnerResponse.push(item);
                            });
                        }
                    },
                    error: function (xhr, status, somthing) {
                        log(status);
                    }
                });
                return localOwnerResponse;
            }, self);

            //Complaint closure
            self.debtorAgreeOptions = ko.observableArray(yesNoOptions);
            self.needFurtherActionOptions = ko.observableArray(yesNoOptions);
            self.finalActionStepOptions = ko.computed(function () {
                var localFinalActionSteps = [];
                $.ajax({
                    url: baseUrl + '/api/Lookup/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { id: 'FinalActionSteps' },
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        //log(data.length);
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                //log(item.Text);
                                localFinalActionSteps.push(item);
                            });
                        }
                    },
                    error: function (xhr, status, somthing) {
                        log(status);
                    }
                });
                return localFinalActionSteps;
            }, self);

            self.complianceModel.agency.subscribe(function (agencySelected) {
                if (self.pimsAccountNumber()) {
                    self.getComplaint(self.pimsAccountNumber());
                    var randonNumber = Math.floor((Math.random() * 999) + 101);
                    log(randonNumber);
                    self.complianceModel.complaintID(agencySelected + '-' + self.pimsAccountNumber().substring(5, 10) + '-' + randonNumber);
                }

            } .bind(self));
            self.saveComplaint = function () {
                $('#messageSummary ul').empty();
                self.validationErrors([]);
                if (self.complianceModel.agency() == '' || self.complianceModel.agency() == undefined)
                    self.validationErrors.push('Agency Name is a required field');
                if (self.complianceModel.account() == '' || self.complianceModel.account() == undefined)
                    self.validationErrors.push('Consumer Account is a required field');
                if (self.complianceModel.lastFourSSN() == '' || self.complianceModel.lastFourSSN() == undefined)
                    self.validationErrors.push('Last 4 digits of SSN is a required field');
                if (self.complianceModel.lastName() == '' || self.complianceModel.lastName() == undefined)
                    self.validationErrors.push('Last Name is a required field');
                if (self.complianceModel.firstName() == '' || self.complianceModel.firstName() == undefined)
                    self.validationErrors.push('First Name is a required field');
                if (self.complianceModel.complaintID() == '' || self.complianceModel.complaintID() == undefined)
                    self.validationErrors.push('Complaint ID is a required field');
                if (self.complianceModel.complaintDate() == '' || self.complianceModel.complaintDate() == undefined)
                    self.validationErrors.push('Complaint Date is a required field');

                if (self.validationErrors().length > 0) {
                    $.each(self.validationErrors(), function (i, item) {
                        $('#messageSummary ul').append('<li>' + item + '</li>');
                    });
                    $("#messageSummary").dialog('open');
                }
                else {
                    self.showMessage(true);
                    self.message('Data saved successfully!');
                    self.complianceModel.save();

                    if (self.complianceModel.complaintinfoDocumentChecked() == true || self.complianceModel.debtOwnerProcessDocumentChecked() == true) {
                        log(self.complianceModel.complaintinfoDocumentChecked());
                        log(self.complianceModel.debtOwnerProcessDocumentChecked());
                        $('#fileUploadContainer').dialog('open');
                    }
                }
            }
            self.showMessage = ko.observable(false);
            self.message = ko.observable('');
            //self.saveVisible = ko.observable(false);
            self.saveVisible = ko.computed(function () {
                if (self.complianceModel.account() != '' && self.complianceModel.lastName() != '' && self.complianceModel.firstName() != '' && self.complianceModel.agency() != '')
                    return true;
                else
                    return false;
            }, self);

            /* Show/Hide Options */
            self.showComplaintSumittedToAgencyInfo = ko.computed(function () {
                if (self.userRole() != 'agency')
                    return true;
                return false;
            }).bind(self);
            self.showDebtInformation = ko.observable(true);
            self.showComplaintInformation = ko.observable(true);
            self.showDebtOwnerProcess = ko.observable(true);
            self.showComplaintClosure = ko.observable(true);
            self.showHideDebtInformation = function () {
                if (self.showDebtInformation())
                    self.showDebtInformation(false);
                else
                    self.showDebtInformation(true);
            }
            self.showHideComplaintInformation = function () {
                if (self.showComplaintInformation())
                    self.showComplaintInformation(false);
                else
                    self.showComplaintInformation(true);
            }
            self.showHideDebtOwnerProcess = function () {
                if (self.showDebtOwnerProcess())
                    self.showDebtOwnerProcess(false);
                else
                    self.showDebtOwnerProcess(true);
            }
            self.showHideComplaintClosure = function () {
                if (self.showComplaintClosure())
                    self.showComplaintClosure(false);
                else
                    self.showComplaintClosure(true);
            }
            self.validationErrors = ko.observableArray([]);
        }

        $(document).ready(function () {
            $('#messageSummary').dialog({ modal: true, title: 'Errors:', autoOpen: false, width: 200, height: 200 });
            var pageVM = new pageViewModel($('#hdnUserId').val(), $('#hdnAgencyId').val(), $('#hdnAccountNumber').val(), $('#hdnUserRole').val());
            $('#fileUploadContainer').dialog({ modal: true, title: 'Upload documents:', autoOpen: false, width: 500, height: 500 });
            ko.applyBindings(pageVM);
            pageVM.getComplaint($('#hdnAccountNumber').val());

            //For DatePicker for Complaint section
            $('#complaiintDate').datepicker({ dateFormat: 'mm/dd/yy' });
            $('#moreInfoRequestedDate').datepicker({ dateFormat: 'mm/dd/yy' });
            $('#moreInfoReceivedDate').datepicker({ dateFormat: 'mm/dd/yy' });
            $('#dateSubmittedToAgency').datepicker({ dateFormat: 'mm/dd/yy' });
            //Debt Owner
            $('#complaintSubmittedDate').datepicker({ dateFormat: 'mm/dd/yy' });
            $('#moreInfoFromAgencyRequestedDate').datepicker({ dateFormat: 'mm/dd/yy' });
            $('#moreInfoFromAgencyReceivedDate').datepicker({ dateFormat: 'mm/dd/yy' });
            $('#ownerResponseDate').datepicker({ dateFormat: 'mm/dd/yy' });

            $('#agencyResponseToDebtorDate').datepicker();
        });


        ko.bindingHandlers.fadeVisible = {
            init: function (element, valueAccessor) {
                var value = valueAccessor();
            },
            update: function (element, valueAccessor) {
                var value = valueAccessor();
                ko.utils.unwrapObservable(value) ? $(element).fadeIn(3000, function () {
                    $(element).fadeOut(5000);
                    value(false)
                }) : $(element).fadeOut();
            }
        };

    </script>
}
