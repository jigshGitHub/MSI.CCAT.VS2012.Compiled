@Html.Hidden("hdnUserId", (string)(@ViewBag.UserID))
@Html.Hidden("hdnAgencyId", (string)(@ViewBag.AgencyID))
@Html.Hidden("hdnAccountNumber", (string)(@ViewBag.Account))
@Html.Hidden("hdnUserRole", (string)(@ViewBag.UserRole))
<style>
    td {
        vertical-align:top;
    }
    
</style>

<div id="workspaceContainer" class="container-fluid">
    <div class='page-title'>View and edit Complaint</div>
    <div style="display:none" id="successAlert" class="alert alert-success alert-block fade">
        <a class="close" onclick="$(this).parent().removeClass('in').toggle();">×</a>
        <strong>Success!</strong><span data-bind="    text: message"></span>.  
    </div>
    <div style="display:none" m id="infoAlert" class="alert alert-info alert-block fade">
        <a class="close" onclick="$(this).parent().removeClass('in').toggle();">×</a>
        <strong>warning!</strong><span data-bind="    text: message"></span>
    </div>
    <div style="display:none" id="errorAlert" class="alert alert-error alert-block fade">
        <a class="close" onclick="$(this).parent().removeClass('in').toggle();">×</a>
        <strong>error!</strong><span data-bind="    text: message"></span>
    </div>
    <div class="modal hide fade" id="fileUploadContainer">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>Upload document:</h3>
        </div>
        <div class="modal-body" data-bind="with: complianceModel">
            @using (Html.BeginForm("UploadDocument", "Home", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                <div data-bind="visible: complaintinfoDocumentChecked">
                    Select document for complaint information:<input name="complaintDocument" type="file" />
                </div>
                <div data-bind="visible: debtOwnerProcessDocumentChecked">
                    Select document for manager process:<input name="debtOwnerProcessDocument" type="file" />
                </div>
                <input type="hidden" name="hdnAccount" data-bind="value: account" />
                <input type="hidden" name="hdnAgency" data-bind="value: agency" />
                <input type="submit" value="Submit" class="btn btn-primary"/>
            }
        </div>    
        <div class="modal-footer" /> 
    </div>  
    <div class="modal hide fade" id="messageSummary" style="font-size: small">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>Errors:</h3>
        </div>
        <div class="modal-body" data-bind="with: validationErrors">
            <ul>
                <li data-bind="text: $data"></li>
            </ul>
        </div>        
        <div class="modal-footer" /> 
    </div>
    <table class="tblCommon" style="width: 100%">
        <tr>
            <td style="text-align: right">
                <img src="~/Content/images/savebutton.png" id="saveRecord" style="position:absolute;z-index:1000;top:0; right:0;position:absolute; float:right;" data-bind="click: saveComplaint, visible: saveVisible" />
            </td>
        </tr>
        <tr>
            <td>
                <table class="PIMSDatatable" style="width: 100%;">
                    <tr>
                        <td style="width: 100%; background-color: #1f497d">
                            <a href="#" style="text-decoration: none; font-weight: bold; color: white" data-bind="click: showHideDebtInformation">Consumer & Debt Information</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="debtInformation" data-bind="with: complianceModel, visible: showDebtInformation">
                                <table class="debtorInfo">
                                    <tr>
                                        <td colspan="6" style="text-align: right">* = Required fields
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Agency Name
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left;" colspan="4">
                                            <select data-bind="options: $parent.agencies, optionsValue: 'Value', optionsCaption: ' ', optionsText: 'Text', value: agency, disable: $parent.agenciesDisable">
                                            </select>*
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Consumer Account #
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: account" />*
                                        </td>
                                        <td style="text-align: right; width: 20%">Last 4 of SSN
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: lastFourSSN" />*
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Last Name
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: lastName" />*
                                        </td>
                                        <td style="text-align: right; width: 20%">Verified Consumer Identity?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.debtorIdentities, optionsValue: 'Value', optionsText: 'Text', value: debtorIdentityVerified_YesNo">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">First Name
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: firstName" />
                                        *
                                            <td style="text-align: right; width: 20%">Best Contact Method
                                            </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.contactMethods, optionsValue: 'Value', optionsText: 'Text', optionsCaption: ' ', value: contactMethodId">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Address
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: address" />
                                        <td style="text-align: right; width: 20%">Best Contact Time
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.contactTimeOptions, optionsValue: 'Value', optionsText: 'Text', optionsCaption: ' ', value: contactTimeId">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">City
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: city" />
                                        <td style="text-align: right; width: 20%">Creditor Name
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: creditorName" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">State
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.stateOptions, optionsValue: 'Value', optionsText: 'Text', optionsCaption: ' ', value: stateId">
                                            </select>
                                        <td style="text-align: right; width: 20%">Debt Product
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.debtProductOptions, optionsValue: 'Value', optionsText: 'Text', optionsCaption: ' ', value: debtProductId">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Zip
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: zip" />
                                        <td style="text-align: right; width: 20%">Debt Balance at Purchase
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: debtPurchaseBalance" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Home Phone
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: homePhone" />
                                        <td style="text-align: right; width: 20%">Debt Balance (Current)
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: debtCurrentBalance" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Work Phone
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: workPhone" />
                                        <td style="text-align: right; width: 20%">Dispute Debt?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.disputeDebtOptions, optionsValue: 'Value', optionsText: 'Text', value: disputeDebt_YesNo">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Mobile Phone
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: mobilePhone" />
                                        <td style="text-align: right; width: 20%">Dispute Debt Amount?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.disputeDebtAmtOptions, optionsValue: 'Value', optionsText: 'Text', value: disputeDebtAmount_YesNo">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">&nbsp;
                                        </td>
                                        <td style="text-align: center; width: 1%"></td>
                                        <td style="text-align: left; width: 20%">
                                        &nbsp;
                                            <td style="text-align: right; width: 20%">Dispute Debt Due Date?
                                            </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.disputeDebtDueDateOptions, optionsValue: 'Value', optionsText: 'Text', value: disputeDebtDueDate_YesNo">
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 100%; background-color: #1f497d">
                            <a href="#" style="text-decoration: none; font-weight: bold; color: white" data-bind="click: showHideComplaintInformation">Complaint Information</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="complaintInformation" data-bind="with: complianceModel, visible: showComplaintInformation">
                                <table class="complaintInfo">
                                    <tr>
                                        <td style="text-align: right; width: 20%">Complaint ID #
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" data-bind="value: complaintID, enable: false" />
                                        *
                                            <td style="text-align: right; width: 20%">Complaint Date
                                            </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="complaiintDate" data-bind="value: complaintDate" />
                                        *
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Complaint Received By
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.complaintRecvdByOptions, optionsValue: 'Value', optionsText: 'Text', optionsCaption: ' ', value: complaintReceivedByMethodId">
                                            </select>
                                        <td style="text-align: right; width: 20%">Complaint Issue
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.complaintIssueOptions, optionsValue: 'Value', optionsText: 'Text', optionsCaption: ' ', value: complaintIssueId">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Complaint Notes
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <textarea rows="4" cols="25" data-bind="value: complaintNotes"></textarea>
                                        <td style="text-align: right; width: 20%">Upload Document
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="checkbox" data-bind="checked: complaintinfoDocumentChecked" />&nbsp;<a
                                                data-bind="attr: { href: complaintDocUrl }"><span data-bind="    text: complaintDocument"></span></a>
                                        </td>
                                    </tr>
                                    <tr data-bind="visible: $parent.showComplaintSumittedToAgencyInfo">
                                        <td style="text-align: right; width: 20%">Submitted Complaint to Agency?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.yesNoOptions, optionsValue: 'Value', optionsText: 'Text', value: complaintSubmitedToAgency_YesNo">
                                            </select>
                                        <td style="text-align: right; width: 20%">Date Submitted
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="dateSubmittedToAgency" data-bind="value: complaintSubmitedToAgencyDate" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Need More Info from Consumer?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.needMoreInfoDebtorOptions, optionsValue: 'Value', optionsText: 'Text', value: moreInfoReqdFromDebtor_YesNo">
                                            </select>
                                        <td style="text-align: right; width: 20%">Date Requested
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="moreInfoRequestedDate" data-bind="value: moreInfoRequestedDate" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">More Info Requested
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <textarea rows="4" cols="25" data-bind="value: moreInfoRequested"></textarea>
                                        <td style="text-align: right; width: 20%">More Consumer Info Received?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.moreInfoRecvdDebtorOptions, optionsValue: 'Value', optionsText: 'Text', value: moreInfoReceivedFromDebtor_YesNo">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Date Received
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="moreInfoReceivedDate" data-bind="value: moreInfoReceivedDate" />
                                        <td style="text-align: right; width: 20%">More Info Received
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <textarea rows="4" cols="25" data-bind="value: moreInfoReceived"></textarea>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 100%; background-color: #1f497d">
                            <a href="#" style="text-decoration: none; font-weight: bold; color: white" data-bind="click: showHideCollectionAgencyProcess">Collection Agency Process</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="collectionAgencyProcess" data-bind="with: complianceModel, visible: showCollectionAgencyProcess">
                                <table>
                                     <tr>
                                        <td style="text-align: right; width: 20%">Manager Response
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select disabled="disabled" data-bind="options: $parent.ownerResponseOptions, optionsValue: 'Value', optionsText: 'Text', optionsCaption: ' ', value: ownerResponseId">
                                            </select>
                                        <td style="text-align: right; width: 20%">Manager Response to Agency Date
                                        </td>
                                        <td style="text-align: center; width: 1%"></td>
                                        <td style="text-align: left; width: 20%"><input type="text" disabled="disabled" data-bind="value: ownerResponseDate" />
                                        </td>
                                    </tr>                                    
                                    <tr>
                                        <td style="text-align: right; width: 20%">Submitted Complaint to Manager?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.complaintSubmittedToOwnerOptions, optionsValue: 'Value', optionsText: 'Text', value: complaintSubmittedToOwner_YesNo">
                                            </select>
                                        <td style="text-align: right; width: 20%">Date Submitted
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="complaintSubmittedDate" data-bind="value: complaintSubmittedDate" />
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Time to Submit (Days)
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" disabled="disabled" data-bind="value: timeToSubmitDays" />
                                        <td style="text-align: right; width: 20%">Upload Document
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="checkbox" data-bind="checked: debtOwnerProcessDocumentChecked" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr data-bind="visible: isDebtOwnerProcessVisible">
                        <td style="width: 100%; background-color: #1f497d">
                            <a href="#" style="text-decoration: none; font-weight: bold; color: white" data-bind="click: showHideDebtOwnerProcess">Manager Process</a>
                        </td>
                    </tr>
                    <tr data-bind="visible: isDebtOwnerProcessVisible">
                        <td>
                            <div id="debtOwnerProcess" data-bind="with: complianceModel, visible: showDebtOwnerProcess">
                                <table class="debtOwnerInfo">
                                    <tr>
                                        <td style="text-align: right; width: 20%">Need More Info from Agency?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.moreInfoFromAgencyOptions, optionsValue: 'Value', optionsText: 'Text', value: moreInfoFromAgency_YesNo">
                                            </select>
                                        <td style="text-align: right; width: 20%">Date Requested
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="moreInfoFromAgencyRequestedDate" data-bind="value: moreInfoFromAgencyRequestedDate" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">More Info Requested
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <textarea rows="4" cols="25" data-bind="value: moreInfoFromAgencyRequested"></textarea>
                                        <td style="text-align: right; width: 20%">More Agency Info Received?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.moreInfoFromAgencyReceivedOptions, optionsValue: 'Value', optionsText: 'Text', value: moreInfoFromAgencyReceived_YesNo">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Date Received
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="moreInfoFromAgencyReceivedDate" data-bind="value: moreInfoFromAgencyReceivedDate" />
                                        <td style="text-align: right; width: 20%">More Info Received
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <textarea rows="4" cols="25" data-bind="value: moreInfoFromAgencyReceived"></textarea>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Manager Response
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.ownerResponseOptions, optionsValue: 'Value', optionsText: 'Text', optionsCaption: ' ', value: ownerResponseId">
                                            </select>
                                        <td style="text-align: right; width: 20%">&nbsp;
                                        </td>
                                        <td style="text-align: center; width: 1%"></td>
                                        <td style="text-align: left; width: 20%">&nbsp;
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Manager Response to Agency Date
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="ownerResponseDate" data-bind="value: ownerResponseDate" />
                                        <td style="text-align: right; width: 20%">Manager Response (Days)
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" disabled="disabled" data-bind="value: ownerResponseDays" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 100%; background-color: #1f497d">
                            <a href="#" style="text-decoration: none; font-weight: bold; color: white" data-bind="click: showHideComplaintClosure">Complaint Closure</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="complaintClosure" data-bind="with: complianceModel, visible: showComplaintClosure">
                                <table class="complaintClosureInfo">
                                    <tr>
                                        <td style="text-align: right; width: 20%">Agency Response to Consumer Date
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" id="agencyResponseToDebtorDate" data-bind="value: agencyResponseToDebtorDate" />
                                        <td style="text-align: right; width: 20%">Total Response Time (Days)
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <input type="text" disabled="disabled" data-bind="value: totalResponseTimeDays" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Consumer Agree?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.debtorAgreeOptions, optionsValue: 'Value', optionsText: 'Text', value: debtorAgree_YesNo">
                                            </select>
                                        <td style="text-align: right; width: 20%">Need further Action?
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.needFurtherActionOptions, optionsValue: 'Value', optionsText: 'Text', value: needFurtherAction_YesNo">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; width: 20%">Final Action Steps
                                        </td>
                                        <td style="text-align: center; width: 1%">:
                                        </td>
                                        <td style="text-align: left; width: 20%">
                                            <select data-bind="options: $parent.finalActionStepOptions, optionsValue: 'Value', optionsCaption: ' ', optionsText: 'Text', value: finalActionStepId">
                                            </select>
                                        <td style="text-align: right; width: 20%">&nbsp;
                                        </td>
                                        <td style="text-align: center; width: 1%"></td>
                                        <td style="text-align: left; width: 20%">&nbsp;
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

@Scripts.Render("~/bundles/knockout")
@Scripts.Render("~/bundles/external")
<script src="~/Scripts/application.js" type="text/javascript"></script>
<script src="~/Scripts/jquery-ui-1.8.11.js" type="text/javascript"></script>
<script src="~/Scripts/compliance.js" type="text/javascript"></script>
<script src="~/Scripts/jquery.formatCurrency-1.4.0.min.js" type="text/javascript"></script>
<script type="text/javascript">
    var yesNoOptions = [{ Text: 'No', Value: 'false' }, { Text: 'Yes', Value: 'true' }];

    function pageViewModel(userId, userAgency, accountNumber, userRole) {
        console.log(userId + ',' + accountNumber + ',' + userAgency + ',' + userRole);
        var self = this;
        if (userRole == 'DebtOwner')
            userAgency = '';
        self.complianceModel = new complianceVM(userId, userAgency);
        self.pimsAccountNumber = ko.observable(accountNumber);
        self.debtors = ko.observableArray([]);
        self.userRole = ko.observable(userRole);
        self.getComplaint = function (account) {
            //log(debtor.account());
            function setComplaint(data) {
                self.complianceModel.populateCompliance(data.Tbl_Account.Tbl_Agency.Name, data.Tbl_Account.AccountNumber, data.Tbl_Account.FirstName, data.Tbl_Account.LastName, '', data.Tbl_Account.Address, data.Tbl_Account.City, data.Tbl_Account.StateId, data.Tbl_Account.Zip, data.Tbl_Account.LastFourSSN, data.Tbl_Account.MobilePhone, data.Tbl_Account.HomePhone, data.Tbl_Account.WorkPhone, data.DebtorIdentityVerifiedYN, data.DebtorContactMethodId, data.DebtorContactTimeId, data.Tbl_Account.DebtCurrentBalance, data.Tbl_Account.DebtPurchaseBalance, data.Tbl_Account.CreditorName, data.DebtorProductId, data.DisputeDebtYN, data.DisputeDebtAmountYN, data.DisputeDebtDueDateYN, data.ComplaintId, data.ComplaintDate, data.ReceivedByMethodId, data.IssuesId, data.ComplaintNotes, data.ComplaintSubmittedToAgencyYN, data.ComplaintSubmittedToAgencyDate, data.MoreInfoReqdFromDebtorYN, data.MoreInfoRequestedDate, data.MoreInfoRequested, data.MoreInfoReceivedFromDebtorYN, data.MoreInfoReceivedDate, data.MoreInfoReceived, data.ComplaintSubmittedToOwnerYN, data.ComplaintSubmittedDate, data.TimeToSubmitDays, data.MoreInfoFromAgencyYN, data.MoreInfoFromAgencyRequestedDate, data.MoreInfoFromAgencyRequested, data.MoreInfoFromAgencyReceived, data.MoreInfoFromAgencyReceivedYN, data.MoreInfoFromAgencyReceivedDate, data.OwnerResponseId, data.OwnerResponseDate, data.OwnerResponseDays, data.AgencyResponseToDebtorDate, data.TotalResponseTimeDays, data.DebtorAgreeYN, data.NeedFurtherActionYN, data.FinalActionStepId, data.CreatedBy, data.ComplaintDocument, data.DebtOwnerProcessDocument);
            };
            self.pimsAccountNumber(account);
            $.ajax({
                url: baseUrl + '/api/Compliance/',
                type: "GET",
                data: { accountNumber: self.pimsAccountNumber(), agencyId: self.complianceModel.agency(), userRole: self.userRole, createUpdateMode: 'update' },
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                async: false,
                success: function (data) {
                    setComplaint(data);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    var responseText = jQuery.parseJSON(jqXHR.responseText);
                    self.message(responseText.ExceptionMessage);
                    showNoti_.error(responseText.ExceptionMessage, false);
                    $('#errorAlert').addClass('in').toggle();
                    return false;
                }
            });
            //self.saveVisible(true);
        }
        self.agenciesDisable = ko.computed(function () { return (self.userRole() == 'agency' || self.pimsAccountNumber() == '' || self.pimsAccountNumber() == undefined) ? true : false }, self);
        self.agencies = ko.computed(function () {
            var localAgencies = [];
            $.ajax({
                url: baseUrl + '/api/Lookup/',
                type: 'GET',
                contentType: 'application/json',
                data: { id: 'Agencies' },
                dataType: 'json',
                async: false,
                success: function (data) {
                    //log(data.length);
                    if (data.length > 0) {
                        $.each(data, function (i, item) {
                            //log(item.Text);
                            localAgencies.push(item);
                        });
                    }
                },
                error: function (xhr, status, somthing) {
                    log(status);
                }
            });
            return localAgencies;
        }, self);
        //For Div debtInformation
        self.debtorIdentities = ko.observableArray(yesNoOptions);
        self.debtorIdentities = ko.observableArray(yesNoOptions);
        self.contactMethods = ko.computed(function () {
            var localContactMethods = [];
            $.ajax({
                url: baseUrl + '/api/Lookup/',
                type: 'GET',
                contentType: 'application/json',
                data: { id: 'DebtorContactMethods' },
                dataType: 'json',
                async: false,
                success: function (data) {
                    //log(data.length);
                    if (data.length > 0) {
                        $.each(data, function (i, item) {
                            //log(item.Text);
                            localContactMethods.push(item);
                        });
                    }
                },
                error: function (xhr, status, somthing) {
                    log(status);
                }
            });
            return localContactMethods;
        }, self);
        self.contactTimeOptions = ko.computed(function () {
            var localTimeOptions = [];
            $.ajax({
                url: baseUrl + '/api/Lookup/',
                type: 'GET',
                contentType: 'application/json',
                data: { id: 'DebtorContactTime' },
                dataType: 'json',
                async: false,
                success: function (data) {
                    //log(data.length);
                    if (data.length > 0) {
                        $.each(data, function (i, item) {
                            //log(item.Text);
                            localTimeOptions.push(item);
                        });
                    }
                },
                error: function (xhr, status, somthing) {
                    log(status);
                }
            });
            return localTimeOptions;
        }, self);
        self.stateOptions = ko.computed(function () {
            var localStates = [];
            $.ajax({
                url: baseUrl + '/api/Lookup/',
                type: 'GET',
                contentType: 'application/json',
                data: { id: 'USStates' },
                dataType: 'json',
                async: false,
                success: function (data) {
                    //log(data.length);
                    if (data.length > 0) {
                        $.each(data, function (i, item) {
                            //log(item.Text);
                            localStates.push(item);
                        });
                    }
                },
                error: function (xhr, status, somthing) {
                    log(status);
                }
            });
            return localStates;
        }, self);
        self.debtProductOptions = ko.computed(function () {
            var localProducts = [];
            $.ajax({
                url: baseUrl + '/api/Lookup/',
                type: 'GET',
                contentType: 'application/json',
                data: { id: 'DetorProducts' },
                dataType: 'json',
                async: false,
                success: function (data) {
                    //log(data.length);
                    if (data.length > 0) {
                        $.each(data, function (i, item) {
                            //log(item.Text);
                            localProducts.push(item);
                        });
                    }
                },
                error: function (xhr, status, somthing) {
                    log(status);
                }
            });
            return localProducts;
        }, self);
        self.disputeDebtOptions = ko.observableArray(yesNoOptions);
        self.disputeDebtAmtOptions = ko.observableArray(yesNoOptions);
        self.disputeDebtDueDateOptions = ko.observableArray(yesNoOptions);

        //For complaintInformation
        self.complaintRecvdByOptions = ko.computed(function () {
            var localComplaintReceivedBy = [];
            $.ajax({
                url: baseUrl + '/api/Lookup/',
                type: 'GET',
                contentType: 'application/json',
                data: { id: 'ComplaintReceivedBy' },
                dataType: 'json',
                async: false,
                success: function (data) {
                    //log(data.length);
                    if (data.length > 0) {
                        $.each(data, function (i, item) {
                            //log(item.Text);
                            localComplaintReceivedBy.push(item);
                        });
                    }
                },
                error: function (xhr, status, somthing) {
                    log(status);
                }
            });
            return localComplaintReceivedBy;
        }, self);
        self.complaintIssueOptions = ko.computed(function () {
            var localComplaintIssues = [];
            $.ajax({
                url: baseUrl + '/api/Lookup/',
                type: 'GET',
                contentType: 'application/json',
                data: { id: 'ComplaintIssues' },
                dataType: 'json',
                async: false,
                success: function (data) {
                    //log(data.length);
                    if (data.length > 0) {
                        $.each(data, function (i, item) {
                            //log(item.Text);
                            localComplaintIssues.push(item);
                        });
                    }
                },
                error: function (xhr, status, somthing) {
                    log(status);
                }
            });
            return localComplaintIssues;
        }, self);
        self.needMoreInfoDebtorOptions = ko.observableArray(yesNoOptions);
        self.moreInfoRecvdDebtorOptions = ko.observableArray(yesNoOptions);
        self.yesNoOptions = ko.observableArray(yesNoOptions);

        //Debt Owner
        self.complaintSubmittedToOwnerOptions = ko.observableArray(yesNoOptions);
        self.moreInfoFromAgencyOptions = ko.observableArray(yesNoOptions);
        self.moreInfoFromAgencyReceivedOptions = ko.observableArray(yesNoOptions);
        self.ownerResponseOptions = ko.computed(function () {
            var localOwnerResponse = [];
            $.ajax({
                url: baseUrl + '/api/Lookup/',
                type: 'GET',
                contentType: 'application/json',
                data: { id: 'OwnerResponse' },
                dataType: 'json',
                async: false,
                success: function (data) {
                    //log(data.length);
                    if (data.length > 0) {
                        $.each(data, function (i, item) {
                            //log(item.Text);
                            localOwnerResponse.push(item);
                        });
                    }
                },
                error: function (xhr, status, somthing) {
                    log(status);
                }
            });
            return localOwnerResponse;
        }, self);

        //Complaint closure
        self.debtorAgreeOptions = ko.observableArray(yesNoOptions);
        self.needFurtherActionOptions = ko.observableArray(yesNoOptions);
        self.finalActionStepOptions = ko.computed(function () {
            var localFinalActionSteps = [];
            $.ajax({
                url: baseUrl + '/api/Lookup/',
                type: 'GET',
                contentType: 'application/json',
                data: { id: 'FinalActionSteps' },
                dataType: 'json',
                async: false,
                success: function (data) {
                    //log(data.length);
                    if (data.length > 0) {
                        $.each(data, function (i, item) {
                            //log(item.Text);
                            localFinalActionSteps.push(item);
                        });
                    }
                },
                error: function (xhr, status, somthing) {
                    log(status);
                }
            });
            return localFinalActionSteps;
        }, self);

        self.complianceModel.agency.subscribe(function (agencySelected) {
            if (self.pimsAccountNumber()) {
                self.getComplaint(self.pimsAccountNumber());
                var randonNumber = Math.floor((Math.random() * 999) + 101);
                log(randonNumber);
                self.complianceModel.complaintID(agencySelected + '-' + self.pimsAccountNumber().substring(5, 10) + '-' + randonNumber);
            }

        }.bind(self));
        self.saveComplaint = function () {
            $('#messageSummary ul').empty();
            self.validationErrors([]);
            if (self.complianceModel.agency() == '' || self.complianceModel.agency() == undefined)
                self.validationErrors.push('Agency Name is a required field');
            if (self.complianceModel.account() == '' || self.complianceModel.account() == undefined)
                self.validationErrors.push('Consumer Account is a required field');
            if (self.complianceModel.lastFourSSN() == '' || self.complianceModel.lastFourSSN() == undefined)
                self.validationErrors.push('Last 4 digits of SSN is a required field');
            if (self.complianceModel.lastName() == '' || self.complianceModel.lastName() == undefined)
                self.validationErrors.push('Last Name is a required field');
            if (self.complianceModel.firstName() == '' || self.complianceModel.firstName() == undefined)
                self.validationErrors.push('First Name is a required field');
            if (self.complianceModel.complaintID() == '' || self.complianceModel.complaintID() == undefined)
                self.validationErrors.push('Complaint ID is a required field');
            if (self.complianceModel.complaintDate() == '' || self.complianceModel.complaintDate() == undefined)
                self.validationErrors.push('Complaint Date is a required field');

            if (self.validationErrors().length > 0) {
                //$.each(self.validationErrors(), function (i, item) {
                //    $('#messageSummary ul').append('<li>' + item + '</li>');
                //});
                //$("#messageSummary").dialog('open');
                $("#messageSummary").modal();
            }
            else {
                self.complianceModel.save();
                self.message('Data saved successfully!');
                showNoti_.info(self.message(), false);
                $('#successAlert').addClass('in').toggle();

                if (self.complianceModel.complaintinfoDocumentChecked() == true || self.complianceModel.debtOwnerProcessDocumentChecked() == true) {
                    log(self.complianceModel.complaintinfoDocumentChecked());
                    log(self.complianceModel.debtOwnerProcessDocumentChecked());
                    //$('#fileUploadContainer').dialog('open');
                    $('#fileUploadContainer').modal();
                }
            }
        }
        self.showMessage = ko.observable(false);
        self.message = ko.observable('');
        //self.saveVisible = ko.observable(false);
        self.saveVisible = ko.computed(function () {
            if (self.complianceModel.account() != '' && self.complianceModel.lastName() != '' && self.complianceModel.firstName() != '' && self.complianceModel.agency() != '')
                return true;
            else
                return false;
        }, self);

        /* Show/Hide Options */
        self.showComplaintSumittedToAgencyInfo = ko.computed(function () {
            if (self.userRole() != 'agency')
                return true;
            return false;
        }).bind(self);
        self.showDebtInformation = ko.observable(true);
        self.showComplaintInformation = ko.observable(true);
        self.showCollectionAgencyProcess = ko.observable(true);
        self.showDebtOwnerProcess = ko.observable(true);
        self.showComplaintClosure = ko.observable(true);
        self.showHideDebtInformation = function () {
            if (self.showDebtInformation())
                self.showDebtInformation(false);
            else
                self.showDebtInformation(true);
        }
        self.showHideComplaintInformation = function () {
            if (self.showComplaintInformation())
                self.showComplaintInformation(false);
            else
                self.showComplaintInformation(true);
        }
        self.showHideCollectionAgencyProcess = function () {
            if (self.showCollectionAgencyProcess())
                self.showCollectionAgencyProcess(false);
            else
                self.showCollectionAgencyProcess(true);
        }
        self.showHideDebtOwnerProcess = function () {
            if (self.showDebtOwnerProcess())
                self.showDebtOwnerProcess(false);
            else
                self.showDebtOwnerProcess(true);
        }
        self.showHideComplaintClosure = function () {
            if (self.showComplaintClosure())
                self.showComplaintClosure(false);
            else
                self.showComplaintClosure(true);
        }
        self.isDebtOwnerProcessVisible = ko.computed(function () {
            return (self.userRole() == 'CollectionAgency') ? false : true;
        }, self);
        self.validationErrors = ko.observableArray([]);
    }

    $(document).ready(function () {
        //$('#messageSummary').dialog({ modal: true, title: 'Errors:', autoOpen: false, width: 200, height: 200 });
        var pageVM = new pageViewModel($('#hdnUserId').val(), $('#hdnAgencyId').val(), $('#hdnAccountNumber').val(), $('#hdnUserRole').val());
        //$('#fileUploadContainer').dialog({ modal: true, title: 'Upload documents:', autoOpen: false, width: 500, height: 500 });
        ko.applyBindings(pageVM, $('#workspaceContainer')[0]);
        pageVM.getComplaint($('#hdnAccountNumber').val());

        //For DatePicker for Complaint section
        $('#complaiintDate').datepicker({ dateFormat: 'mm/dd/yy' });
        $('#moreInfoRequestedDate').datepicker({ dateFormat: 'mm/dd/yy' });
        $('#moreInfoReceivedDate').datepicker({ dateFormat: 'mm/dd/yy' });
        $('#dateSubmittedToAgency').datepicker({ dateFormat: 'mm/dd/yy' });
        //Debt Owner
        $('#complaintSubmittedDate').datepicker({ dateFormat: 'mm/dd/yy' });
        $('#moreInfoFromAgencyRequestedDate').datepicker({ dateFormat: 'mm/dd/yy' });
        $('#moreInfoFromAgencyReceivedDate').datepicker({ dateFormat: 'mm/dd/yy' });
        $('#ownerResponseDate').datepicker({ dateFormat: 'mm/dd/yy' });

        $('#agencyResponseToDebtorDate').datepicker();
    });


    var $scrollingDiv = $("#saveRecord");
    $(window).scroll(function () {
        $scrollingDiv
            .stop()
            .animate({ "marginTop": ($(window).scrollTop() + 30) + "px" }, "slow");
    });
</script>
